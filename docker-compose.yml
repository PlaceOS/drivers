version: "3.7"
services:
  redis:
    image: eqalpha/keydb
    restart: always
    hostname: redis
    environment:
      - TZ=$TZ

  drivers:
    build:
      context: /Users/tassja/Documents/git/forked/driver-spec-runner
      args:
        crystal_version: ${CRYSTAL_VERSION:-1.0.0}
    image: placeos/drivers
    restart: always
    container_name: placeos-drivers
    hostname: drivers
    environment:
      - CRYSTAL_PATH=lib:/lib/local-shards
    depends_on:
      - redis
    ports:
      - 127.0.0.1:8085:8080
      - 127.0.0.1:4444:4444
    volumes:
      - ./drivers/:/app/drivers/
      - ./repositories/:/app/repositories/
      - ./lib/:/lib/local-shards/
      - ./.git:/app/.git
    environment:
      - REDIS_URL=redis://redis:6379
      - TZ=$TZ
